<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>JAC CARDS</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: #121827; color: #f9d342; font-family: Arial, sans-serif; overflow-x: hidden; position: relative; }
  header { background: #1c2533; text-align: center; padding: 20px; position: relative; z-index: 2; }
  header h1 { font-size: 3em; margin-bottom: 10px; }
  nav a { color: #f9d342; margin: 0 15px; text-decoration: none; font-weight: bold; font-size: 1.2em; cursor: pointer; }
  #listings { display: flex; flex-wrap: wrap; justify-content: center; padding: 20px; position: relative; z-index: 2; }
  .card { background: #1c2533; border: 2px solid #f9d342; border-radius: 12px; width: 220px; margin: 15px; padding: 10px; text-align: center; position: relative; overflow: hidden; }
  .card img { max-width: 100%; border-radius: 8px; display: block; }
  .card button { margin-top: 10px; padding: 6px; width: 100%; border: none; border-radius: 5px; background: #f9d342; color: #1c2533; font-weight: bold; cursor: pointer; }
  #cart { position: fixed; top: 20px; right: 20px; background: rgba(28, 37, 51, 0.9); border: 2px solid #f9d342; border-radius: 10px; padding: 10px; z-index: 3; width: 250px; }
  #cart h2 { font-size: 1.3em; margin-bottom: 10px; }
  #cart ul { list-style: none; margin-bottom: 10px; }
  #cart button { width: 100%; margin-top: 5px; }
  #adminContainer, #passwordPrompt { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #2a3142; padding: 20px; border-radius: 12px; z-index: 4; width: 300px; }
  #adminContainer input, #adminContainer button, #passwordPrompt input, #passwordPrompt button { display: block; width: 100%; margin: 10px 0; padding: 8px; border-radius: 5px; border: none; }
  #adminContainer button, #passwordPrompt button { background: #f9d342; color: #1c2533; font-weight: bold; cursor: pointer; }
  .laser { position: absolute; width: 3px; height: 80px; background: linear-gradient(to bottom, #00ffff, #ff00ff); border-radius: 2px; opacity: 0.9; animation: shoot linear infinite; z-index: 1; filter: drop-shadow(0 0 8px #00ffff) drop-shadow(0 0 8px #ff00ff); }
  @keyframes shoot { 0% { transform: translateX(-50px) translateY(var(--startY)); opacity: 0; } 10% { opacity: 1; } 100% { transform: translateX(120vw) translateY(var(--startY)); opacity: 0; } }
</style>
</head>

<body>
<header>
  <h1>JAC CARDS</h1>
  <nav>
    <a onclick="scrollToShop()">Shop</a>
    <a onclick="showAdmin()">Admin</a>
  </nav>
</header>

<section id="listings"></section>

<div id="cart">
  <h2>Cart</h2>
  <ul id="cartItems"></ul>
  <p>Total: $<span id="cartTotal">0</span></p>
  <button id="checkout-button">Checkout with Stripe</button>
</div>

<div id="passwordPrompt">
  <h2>Enter Admin Password</h2>
  <input type="password" id="adminPassword" placeholder="Password" />
  <button onclick="checkPassword()">Submit</button>
  <p id="passwordError" style="color: red"></p>
</div>

<section id="adminContainer" style="display: none">
  <h2>Admin Panel</h2>
  <input type="text" id="cardName" placeholder="Card Name" />
  <input type="text" id="cardPrice" placeholder="Price" />
  <input type="file" id="cardUpload" multiple />
  <button onclick="addListing()">Add Listing</button>
</section>

<script src="https://js.stripe.com/v3/"></script>

<script>
const ADMIN_PASSWORD = "JACadmin2025";

const listingsContainer = document.getElementById("listings");   // ðŸ”§ FIXED
let cart = [];
let listings = JSON.parse(localStorage.getItem("jac_listings") || "[]");

function scrollToShop() { document.getElementById("listings").scrollIntoView({ behavior: "smooth" }); }
function showAdmin() { passwordPrompt.style.display = "block"; }

function checkPassword() {
  const input = document.getElementById("adminPassword").value;
  if (input === ADMIN_PASSWORD) {
    passwordPrompt.style.display = "none";
    adminContainer.style.display = "block";
  } else {
    passwordError.textContent = "Incorrect password!";
  }
  document.getElementById("adminPassword").value = "";
}

function saveListings() {
  localStorage.setItem("jac_listings", JSON.stringify(listings));
}

function renderListings() {
  listingsContainer.innerHTML = "";
  listings.forEach((card, index) => createCard(card, index));
}

function createCard(cardData, index) {
  const { name, price, images } = cardData;

  const cardDiv = document.createElement("div");
  cardDiv.className = "card";

  let imgIndex = 0;
  const imgEl = document.createElement("img");
  imgEl.src = images[0];
  cardDiv.appendChild(imgEl);

  if (images.length > 1) {
    setInterval(() => {
      imgIndex = (imgIndex + 1) % images.length;
      imgEl.src = images[imgIndex];
    }, 3000);
  }

  const nameEl = document.createElement("h3");
  nameEl.textContent = name;

  const priceEl = document.createElement("p");
  priceEl.textContent = `Price: $${price.toFixed(2)}`;

  const addBtn = document.createElement("button");
  addBtn.textContent = "Add to Cart";
  addBtn.onclick = () => addToCart({ name, price });

  const removeBtn = document.createElement("button");
  removeBtn.textContent = "Remove Listing";
  removeBtn.style.background = "#ff4d4d";
  removeBtn.style.color = "white";
  removeBtn.onclick = () => {
    listings.splice(index, 1);
    saveListings();
    renderListings();
  };

  cardDiv.append(nameEl, priceEl, addBtn, removeBtn);
  listingsContainer.appendChild(cardDiv);
}

async function addListing() {
  const name = document.getElementById("cardName").value;
  const price = parseFloat(document.getElementById("cardPrice").value);
  const files = document.getElementById("cardUpload").files;

  if (!name || !price || files.length === 0) {
    alert("Fill all fields and select images");
    return;
  }

  const imageBase64Arr = [];
  for (let file of files) {
    const base64 = await new Promise((resolve) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.readAsDataURL(file);
    });
    imageBase64Arr.push(base64);
  }

  listings.push({ name, price, images: imageBase64Arr });
  saveListings();
  renderListings();

  document.getElementById("cardName").value = "";
  document.getElementById("cardPrice").value = "";
  document.getElementById("cardUpload").value = "";
}

function addToCart(item) {
  cart.push(item);
  renderCart();
}

function removeFromCart(i) {
  cart.splice(i, 1);
  renderCart();
}

function renderCart() {
  cartItems.innerHTML = "";
  let total = 0;

  cart.forEach((item, i) => {
    let li = document.createElement("li");
    li.textContent = `${item.name} - $${item.price.toFixed(2)} `;

    const x = document.createElement("button");
    x.textContent = "âŒ";
    x.style.background = "transparent";
    x.style.color = "#f9d342";
    x.style.border = "none";
    x.style.cursor = "pointer";
    x.onclick = () => removeFromCart(i);

    li.appendChild(x);
    cartItems.appendChild(li);
    total += item.price;
  });

  cartTotal.textContent = total.toFixed(2);
}

// â­ Stripe Checkout with YOUR publishable key
document.getElementById("checkout-button").addEventListener("click", async () => {
  if (cart.length === 0) { 
    alert("Cart is empty!"); 
    return;
  }

  try {
    const response = await fetch("/api/create-checkout-session", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ cart }),
    });

    const session = await response.json();

    const stripe = Stripe("pk_live_51SNmtxRKwxVF85LUA6cwkmPfOYVVB7cq1LwHEmLe0snshGL6r4q3UgN2evvA9fJ1ysGwHm7L9hgeicVP6jknzdct003hQO51KP");

    await stripe.redirectToCheckout({ sessionId: session.id });

  } catch (err) {
    console.error("Checkout error:", err);
    alert("Error connecting to Stripe Checkout.");
  }
});

// Neon lasers
for (let i = 0; i < 25; i++) {
  const laser = document.createElement("div");
  laser.className = "laser";
  laser.style.setProperty("--startY", Math.random() * window.innerHeight + "px");
  laser.style.animationDuration = (Math.random() * 3 + 2) + "s";
  document.body.appendChild(laser);
}

renderListings();
</script>

</body>
</html>
